{% extends "layout.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='quiz.css') }}">
<script src="{{ url_for('static', filename='quiz.js')}}" defer></script>

{% block javascript %}
<script>
    const ANSWER_URL = {{ url_for('quiz', pl_id = pl.id, game = game.id) | tojson | safe}};
    const RESULTS_URL = {{ url_for('quiz', pl_id = pl.id, game = game.id) | tojson | safe}}
</script>
{% endblock %}

{% endblock %}

{% block title %}
{{ pl.name }}
{% endblock %}

{% block main %}

<div class="col col-lg-7 col-xl-6 mx-auto">
<div class="card h-100" style="">
        
        <div class="card-body">
            <!-- GAME STATUS -->
            <div class="col-12 fw-bold d-flex mb-1 justify-content-around">
                <div> song: <span id="quest_num">1</span>/5</div>
                <div>
                    points: <span id="points">{{ game.points() }}</span>
                </div>
            </div>
            <div id="prog_bar" class="progress mb-4">
            </div>

            <!-- PLAYLIST INFO -->
            <div class="row mb-0">
                <div class="col-12 col-sm-5">
                    <div class="row mb-2">
                        <div class="col-6 col-sm-12">
                            <img src="{{ pl.img.md }}" class="img-fluid rounded-start" style="width: 170px;" alt="...">
                        </div>
                        <div class="col-6 col-sm-12">
                            <h5 class="card-title">
                                <a href="">{{ pl.name }}</a>
                            </h5>
                            <p class="card-text"><small class="text-muted">
                                by <a href="{{ pl.owner.url }}" target="_blank" noopener noreferer>
                                    {{ pl.owner.name }}</a>
                            </small></p>
                            <p class="card-text">{{ pl.description }}</p>
                        </div>
                    </div>
                </div>

                <!-- PLAYER -->
                <div class="col-12 col-sm-7">
                    <div class="container py-0 mb-2">
                        <audio id="player" preload>
                            <source id="audioSource" src="{{ quest.track.prev_url }}" type="audio/mpeg">
                        </audio>
                        <a id="results">
                            <button id="playpause" class="controls w-100 btn btn-light" data-state="play"> </button>
                        </a>
                    </div>
                    <div class="d-flex">
                        <!-- volume control -->
                        <input id="volume" min="0" max="100" value="80" type="range" class="form-range">
                        <!-- mute -->
                        <button id="mute" class="btn btn-light" data-state="not-muted"></button>
                    </div>
                </div>
            </div>
                
            <div class="row">
                <!-- QUESTION -->
                <div class="col-12">
                    <span id="question" class="fw-bold">Guess the title:</span>
                </div>
                <div class="col-12">
                    <div class="d-grid gap-2">
                        {% for track in quest.all_answrs() %}
                            <button id="_{{ track.id }}" class="ans-btn btn btn-lg shadow btn-light position-relative" name="track_id" value="{{ track.id }}" disabled>
                                <span class="d-none position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                </span>
                                {{ track.name }}
                            </button>
                        {% endfor %} 
                    </div>
                </div>
            </div>
        </div>

        <div  class="d-none card-footer text-center">
            
        </div>
    </div>
</div>
{% endblock %}